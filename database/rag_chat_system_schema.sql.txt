-- Create database
CREATE DATABASE rag_chat_system;
USE rag_chat_system;

-- Table to store chat sessions
CREATE TABLE chat_sessions (
    session_id VARCHAR(36) PRIMARY KEY,
    document_source VARCHAR(500),
    chunk_count INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Table to store messages in each session
CREATE TABLE chat_messages (
    message_id INT AUTO_INCREMENT PRIMARY KEY,
    session_id VARCHAR(36),
    message_type ENUM('user', 'bot'),
    content TEXT,
    retrieved_chunks JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (session_id) REFERENCES chat_sessions(session_id) ON DELETE CASCADE
);

-- Table to store document chunks for each session
CREATE TABLE session_chunks (
    session_id VARCHAR(36),
    chunk_index INT,
    chunk_text TEXT,
    PRIMARY KEY (session_id, chunk_index),
    FOREIGN KEY (session_id) REFERENCES chat_sessions(session_id) ON DELETE CASCADE
);

-- Indexes for performance
CREATE INDEX idx_sessions_created ON chat_sessions(created_at);
CREATE INDEX idx_messages_session ON chat_messages(session_id);
CREATE INDEX idx_chunks_session ON session_chunks(session_id);

-- Example queries
SHOW TABLES;
SELECT * FROM chat_sessions;
SELECT * FROM chat_messages;
SELECT * FROM session_chunks;